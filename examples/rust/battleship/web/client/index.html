<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Battleship!</title>
</head>

<body>
  <script src="https://cdn.jsdelivr.net/npm/near-api-js@0.41.0/dist/near-api-js.min.js"></script>
  <script>
    const networkId = 'testnet';
    const appName = 'melvinz.testnet';
    const contractId = 'dev-1649886060949-33800566037764';
    const GAS = "300000000000000";
    const DEPOSIT = "1000000000000";

    function near_connect() {
      // connect to NEAR
      const near = new nearApi.Near({
        networkId,
        keyStore: new nearApi.keyStores.BrowserLocalStorageKeyStore(),
        nodeUrl: 'https://rpc.testnet.near.org',
        walletUrl: 'https://wallet.testnet.near.org',
      });

      // connect to the NEAR Wallet
      const wallet = new nearApi.WalletConnection(near, appName);

      if (!wallet.isSignedIn()) {
        wallet.requestSignIn({
          contractId,
          methodNames: ['game_state', 'new_game', 'join_game', 'turn'],
        });
      }

      // connect to a NEAR smart contract
      const contract = new nearApi.Contract(wallet.account(), contractId, {
        viewMethods: ['game_state'],
        changeMethods: ['new_game', 'join_game', 'turn'],
        sender: wallet.account(),
      });

      return contract;
    }

    function game_state(contract, name) {
      return contract.game_state({ name });
    }

    function new_game(contract, name, receipt_str) {
      return contract.new_game({ name, receipt_str }, GAS, DEPOSIT);
    }

    function join_game(contract, name, receipt_str, shot_x, shot_y) {
      return contract.join_game({ name, receipt_str, shot_x, shot_y }, GAS, DEPOSIT);
    }

    function turn(contract, name, receipt_str, shot_x, shot_y) {
      return contract.turn({ name, receipt_str, shot_x, shot_y }, GAS, DEPOSIT);
    }

  </script>
</body>

</html>
